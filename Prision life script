local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")

local gui = Instance.new("ScreenGui", game:GetService("CoreGui"))
gui.Name = "MandaXMainGUI"
gui.ResetOnSpawn = false
gui.Enabled = true

-- Sidebar
local sidebar = Instance.new("Frame", gui)
sidebar.Size = UDim2.new(0, 120, 1, 0)
sidebar.Position = UDim2.new(0, 0, 0, 0)
sidebar.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
sidebar.BorderSizePixel = 0

local function createSidebarButton(name, text, yPos)
    local btn = Instance.new("TextButton", sidebar)
    btn.Name = name .. "Btn"
    btn.Size = UDim2.new(1, -10, 0, 40)
    btn.Position = UDim2.new(0, 5, 0, yPos)
    btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    btn.BorderSizePixel = 0
    btn.Font = Enum.Font.FredokaOne
    btn.TextSize = 16
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Text = text
    return btn
end

-- Frames para secciones
local sections = {}

-- --- Noclip Section ---
local noclipFrame = Instance.new("Frame", gui)
noclipFrame.Size = UDim2.new(0, 400, 0, 120)
noclipFrame.Position = UDim2.new(0, 130, 0, 20)
noclipFrame.BackgroundColor3 = Color3.fromRGB(255, 235, 100)
noclipFrame.BorderSizePixel = 4
noclipFrame.BorderColor3 = Color3.fromRGB(255, 170, 0)
noclipFrame.Active = true
noclipFrame.Draggable = true
sections["noclip"] = noclipFrame

local noclipTitle = Instance.new("TextLabel", noclipFrame)
noclipTitle.Size = UDim2.new(1, 0, 0, 30)
noclipTitle.Position = UDim2.new(0, 0, 0, 0)
noclipTitle.BackgroundTransparency = 1
noclipTitle.Text = "ðŸ‘» MandaX Noclip"
noclipTitle.Font = Enum.Font.FredokaOne
noclipTitle.TextSize = 20
noclipTitle.TextColor3 = Color3.fromRGB(0, 0, 0)

local noclipButton = Instance.new("TextButton", noclipFrame)
noclipButton.Size = UDim2.new(1, -20, 0, 50)
noclipButton.Position = UDim2.new(0, 10, 0, 50)
noclipButton.BackgroundColor3 = Color3.fromRGB(255, 200, 0)
noclipButton.TextColor3 = Color3.fromRGB(0, 0, 0)
noclipButton.Font = Enum.Font.SourceSansBold
noclipButton.TextSize = 22
noclipButton.Text = "Noclip OFF"

local noclip = false
local noclipConnection = nil

local function setCanCollide(state)
    if LocalPlayer.Character then
        for _, part in pairs(LocalPlayer.Character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = state
            end
        end
    end
end

local function startNoclip()
    noclipConnection = RunService.Stepped:Connect(function()
        if LocalPlayer.Character then
            setCanCollide(false)
        end
    end)
end

local function stopNoclip()
    if noclipConnection then
        noclipConnection:Disconnect()
        noclipConnection = nil
    end
    setCanCollide(true)
end

local function toggleNoclip()
    noclip = not noclip
    if noclip then
        startNoclip()
        noclipButton.Text = "Noclip ON"
        print("Noclip activado")
    else
        stopNoclip()
        noclipButton.Text = "Noclip OFF"
        print("Noclip desactivado")
    end
end

noclipButton.MouseButton1Click:Connect(toggleNoclip)

UIS.InputBegan:Connect(function(input, gameProcessed)
    if input.KeyCode == Enum.KeyCode.N and not gameProcessed then
        toggleNoclip()
    end
end)

LocalPlayer.CharacterAdded:Connect(function(char)
    if noclip then
        wait(1)
        startNoclip()
    end
end)

-- --- Speed Section ---
local speedFrame = Instance.new("Frame", gui)
speedFrame.Size = UDim2.new(0, 400, 0, 140)
speedFrame.Position = UDim2.new(0, 130, 0, 20)
speedFrame.BackgroundColor3 = Color3.fromRGB(255, 235, 100)
speedFrame.BorderSizePixel = 4
speedFrame.BorderColor3 = Color3.fromRGB(255, 170, 0)
speedFrame.Active = true
speedFrame.Draggable = true
speedFrame.Visible = false
sections["speed"] = speedFrame

local speedTitle = Instance.new("TextLabel", speedFrame)
speedTitle.Size = UDim2.new(1, 0, 0, 30)
speedTitle.Position = UDim2.new(0, 0, 0, 0)
speedTitle.BackgroundTransparency = 1
speedTitle.Text = "âš¡ MandaX Speed Hack"
speedTitle.Font = Enum.Font.FredokaOne
speedTitle.TextSize = 20
speedTitle.TextColor3 = Color3.fromRGB(0, 0, 0)

local speedInput = Instance.new("TextBox", speedFrame)
speedInput.Size = UDim2.new(1, -20, 0, 40)
speedInput.Position = UDim2.new(0, 10, 0, 40)
speedInput.PlaceholderText = "Velocidad (ej: 100)"
speedInput.Font = Enum.Font.GothamBold
speedInput.TextSize = 20
speedInput.TextColor3 = Color3.fromRGB(0, 0, 0)
speedInput.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
speedInput.Text = ""

local speedButton = Instance.new("TextButton", speedFrame)
speedButton.Size = UDim2.new(1, -20, 0, 35)
speedButton.Position = UDim2.new(0, 10, 0, 90)
speedButton.BackgroundColor3 = Color3.fromRGB(255, 200, 0)
speedButton.Text = "Activar velocidad"
speedButton.Font = Enum.Font.SourceSansBold
speedButton.TextSize = 20
speedButton.TextColor3 = Color3.fromRGB(0, 0, 0)

speedButton.MouseButton1Click:Connect(function()
    local value = tonumber(speedInput.Text)
    if value and value > 0 then
        local hum = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.WalkSpeed = value
            speedButton.Text = "Velocidad: " .. value
        end
    else
        speedButton.Text = "Valor invÃ¡lido"
        wait(1)
        speedButton.Text = "Activar velocidad"
    end
end)

LocalPlayer.CharacterAdded:Connect(function(char)
    wait(1)
    local val = tonumber(speedInput.Text)
    if val and val > 0 then
        local hum = char:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.WalkSpeed = val
        end
    end
end)

-- --- Fly Section ---
local flyFrame = Instance.new("Frame", gui)
flyFrame.Size = UDim2.new(0, 400, 0, 110)
flyFrame.Position = UDim2.new(0, 130, 0, 20)
flyFrame.BackgroundColor3 = Color3.fromRGB(200, 235, 255)
flyFrame.BorderSizePixel = 4
flyFrame.BorderColor3 = Color3.fromRGB(0, 170, 255)
flyFrame.Active = true
flyFrame.Draggable = true
flyFrame.Visible = false
sections["fly"] = flyFrame

local flyTitle = Instance.new("TextLabel", flyFrame)
flyTitle.Size = UDim2.new(1, 0, 0, 30)
flyTitle.Position = UDim2.new(0, 0, 0, 0)
flyTitle.BackgroundTransparency = 1
flyTitle.Text = "ðŸ•Šï¸ MandaX Fly Hack"
flyTitle.Font = Enum.Font.FredokaOne
flyTitle.TextSize = 20
flyTitle.TextColor3 = Color3.fromRGB(0, 0, 0)

local flyButton = Instance.new("TextButton", flyFrame)
flyButton.Size = UDim2.new(1, -20, 0, 50)
flyButton.Position = UDim2.new(0, 10, 0, 45)
flyButton.BackgroundColor3 = Color3.fromRGB(0, 200, 255)
flyButton.Text = "Activar Fly"
flyButton.Font = Enum.Font.SourceSansBold
flyButton.TextSize = 22
flyButton.TextColor3 = Color3.fromRGB(0, 0, 0)

local flying = false
local flyConnection

local function setFly(active)
    flying = active
    local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        humanoid.PlatformStand = false
    end

    if flyConnection then
        flyConnection:Disconnect()
        flyConnection = nil
    end

    if flying and root then
        local bv = Instance.new("BodyVelocity")
        bv.Name = "FlyVelocity"
        bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
        bv.Velocity = Vector3.zero
        bv.Parent = root

        flyConnection = RunService.RenderStepped:Connect(function()
            if not root or not root:FindFirstChild("FlyVelocity") then return end

            local cam = workspace.CurrentCamera
            local moveVec = Vector3.zero

            if UIS:IsKeyDown(Enum.KeyCode.W) then moveVec += cam.CFrame.LookVector end
            if UIS:IsKeyDown(Enum.KeyCode.S) then moveVec -= cam.CFrame.LookVector end
            if UIS:IsKeyDown(Enum.KeyCode.A) then moveVec -= cam.CFrame.RightVector end
            if UIS:IsKeyDown(Enum.KeyCode.D) then moveVec += cam.CFrame.RightVector end
            if UIS:IsKeyDown(Enum.KeyCode.Space) then moveVec += cam.CFrame.UpVector end
            if UIS:IsKeyDown(Enum.KeyCode.LeftControl) then moveVec -= cam.CFrame.UpVector end

            if moveVec.Magnitude > 0 then
                moveVec = moveVec.Unit * 80
            else
                moveVec = Vector3.zero
            end

            root.FlyVelocity.Velocity = moveVec
        end)

        flyButton.Text = "Desactivar Fly"
    else
        if root and root:FindFirstChild("FlyVelocity") then
            root.FlyVelocity:Destroy()
        end
        flyButton.Text = "Activar Fly"
    end
end

flyButton.MouseButton1Click:Connect(function()
    setFly(not flying)
end)

UIS.InputBegan:Connect(function(input, gameProcessed)
    if input.KeyCode == Enum.KeyCode.F and not gameProcessed then
        setFly(not flying)
    end
end)

LocalPlayer.CharacterAdded:Connect(function(char)
    wait(1)
    if flying then
        setFly(true)
    end
end)

-- --- Kill Aura Section ---
local killAuraFrame = Instance.new("Frame", gui)
killAuraFrame.Size = UDim2.new(0, 400, 0, 100)
killAuraFrame.Position = UDim2.new(0, 130, 0, 20)
killAuraFrame.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
killAuraFrame.BorderSizePixel = 4
killAuraFrame.BorderColor3 = Color3.fromRGB(170, 0, 0)
killAuraFrame.Active = true
killAuraFrame.Draggable = true
killAuraFrame.Visible = false
sections["killAura"] = killAuraFrame

local killAuraTitle = Instance.new("TextLabel", killAuraFrame)
killAuraTitle.Size = UDim2.new(1, 0, 0, 30)
killAuraTitle.Position = UDim2.new(0, 0, 0, 0)
killAuraTitle.BackgroundTransparency = 1
killAuraTitle.Text = "ðŸ’£ MandaX Kill Aura Ultra"
killAuraTitle.Font = Enum.Font.FredokaOne
killAuraTitle.TextSize = 20
killAuraTitle.TextColor3 = Color3.fromRGB(0, 0, 0)

local killAuraButton = Instance.new("TextButton", killAuraFrame)
killAuraButton.Size = UDim2.new(1, -20, 0, 40)
killAuraButton.Position = UDim2.new(0, 10, 0, 50)
killAuraButton.BackgroundColor3 = Color3.fromRGB(255, 40, 40)
killAuraButton.Text = "Activar Kill Aura"
killAuraButton.Font = Enum.Font.SourceSansBold
killAuraButton.TextSize = 20
killAuraButton.TextColor3 = Color3.fromRGB(0, 0, 0)

local auraEnabled = false
local killAuraConnection

local function toggleAura()
    auraEnabled = not auraEnabled
    killAuraButton.Text = auraEnabled and "Desactivar Kill Aura" or "Activar Kill Aura"

    if auraEnabled then
        killAuraConnection = RunService.RenderStepped:Connect(function()
            local myChar = LocalPlayer.Character
            local myHRP = myChar and myChar:FindFirstChild("HumanoidRootPart")
            if not myHRP then return end

            for _, plr in pairs(Players:GetPlayers()) do
                if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                    local target = plr.Character
                    local targetHRP = target.HumanoidRootPart
                    local dist = (myHRP.Position - targetHRP.Position).Magnitude
                    if dist <= 20 then
                        pcall(function()
                            target:BreakJoints()
                        end)
                    end
                end
            end
        end)
    else
        if killAuraConnection then
            killAuraConnection:Disconnect()
            killAuraConnection = nil
        end
    end
end

killAuraButton.MouseButton1Click:Connect(toggleAura)

-- --- TP CÃ¡rcel Section ---
local jailPosition = Vector3.new(910.18, 107.32, 2375.59)

local tpJailFrame = Instance.new("Frame", gui)
tpJailFrame.Size = UDim2.new(0, 400, 0, 100)
tpJailFrame.Position = UDim2.new(0, 130, 0, 20)
tpJailFrame.BackgroundColor3 = Color3.fromRGB(80, 130, 200)
tpJailFrame.BorderSizePixel = 4
tpJailFrame.BorderColor3 = Color3.fromRGB(40, 80, 150)
tpJailFrame.Active = true
tpJailFrame.Draggable = true
tpJailFrame.Visible = false
sections["tpJail"] = tpJailFrame

local tpJailTitle = Instance.new("TextLabel", tpJailFrame)
tpJailTitle.Size = UDim2.new(1, 0, 0, 30)
tpJailTitle.BackgroundTransparency = 1
tpJailTitle.Text = "ðŸš“ Teleport CÃ¡rcel"
tpJailTitle.Font = Enum.Font.FredokaOne
tpJailTitle.TextSize = 20
tpJailTitle.TextColor3 = Color3.fromRGB(0, 0, 0)

local tpJailButton = Instance.new("TextButton", tpJailFrame)
tpJailButton.Size = UDim2.new(1, -20, 0, 50)
tpJailButton.Position = UDim2.new(0, 10, 0, 40)
tpJailButton.BackgroundColor3 = Color3.fromRGB(60, 100, 180)
tpJailButton.Text = "Ir a la CÃ¡rcel"
tpJailButton.Font = Enum.Font.SourceSansBold
tpJailButton.TextSize = 18
tpJailButton.TextColor3 = Color3.fromRGB(255, 255, 255)

tpJailButton.MouseButton1Click:Connect(function()
    local char = LocalPlayer.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    hrp.CFrame = CFrame.new(jailPosition)
end)

-- --- Escapar Section ---
local escapePosition = Vector3.new(-942.53, 94.13, 2060.42)

local escapeFrame = Instance.new("Frame", gui)
escapeFrame.Size = UDim2.new(0, 400, 0, 100)
escapeFrame.Position = UDim2.new(0, 130, 0, 20)
escapeFrame.BackgroundColor3 = Color3.fromRGB(80, 160, 90)
escapeFrame.BorderSizePixel = 4
escapeFrame.BorderColor3 = Color3.fromRGB(40, 120, 60)
escapeFrame.Active = true
escapeFrame.Draggable = true
escapeFrame.Visible = false
sections["escape"] = escapeFrame

local escapeTitle = Instance.new("TextLabel", escapeFrame)
escapeTitle.Size = UDim2.new(1, 0, 0, 30)
escapeTitle.BackgroundTransparency = 1
escapeTitle.Text = "ðŸƒ Escapar"
escapeTitle.Font = Enum.Font.FredokaOne
escapeTitle.TextSize = 20
escapeTitle.TextColor3 = Color3.fromRGB(0, 0, 0)

local escapeButton = Instance.new("TextButton", escapeFrame)
escapeButton.Size = UDim2.new(1, -20, 0, 50)
escapeButton.Position = UDim2.new(0, 10, 0, 40)
escapeButton.BackgroundColor3 = Color3.fromRGB(70, 200, 120)
escapeButton.Text = "Escapar"
escapeButton.Font = Enum.Font.SourceSansBold
escapeButton.TextSize = 18
escapeButton.TextColor3 = Color3.fromRGB(255, 255, 255)

escapeButton.MouseButton1Click:Connect(function()
    local char = LocalPlayer.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    hrp.CFrame = CFrame.new(escapePosition)
end)

-- --- Teleport to Player Section ---
local tpPlayerFrame = Instance.new("Frame", gui)
tpPlayerFrame.Size = UDim2.new(0, 400, 0, 200)
tpPlayerFrame.Position = UDim2.new(0, 130, 0, 20)
tpPlayerFrame.BackgroundColor3 = Color3.fromRGB(120, 150, 230)
tpPlayerFrame.BorderSizePixel = 4
tpPlayerFrame.BorderColor3 = Color3.fromRGB(80, 110, 200)
tpPlayerFrame.Active = true
tpPlayerFrame.Draggable = true
tpPlayerFrame.Visible = false
sections["tpPlayer"] = tpPlayerFrame

local tpPlayerTitle = Instance.new("TextLabel", tpPlayerFrame)
tpPlayerTitle.Size = UDim2.new(1, 0, 0, 30)
tpPlayerTitle.BackgroundTransparency = 1
tpPlayerTitle.Text = "ðŸ“ Teleport a Jugador"
tpPlayerTitle.Font = Enum.Font.FredokaOne
tpPlayerTitle.TextSize = 20
tpPlayerTitle.TextColor3 = Color3.fromRGB(0, 0, 0)

local dropdown = Instance.new("TextButton", tpPlayerFrame)
dropdown.Size = UDim2.new(1, -20, 0, 35)
dropdown.Position = UDim2.new(0, 10, 0, 40)
dropdown.BackgroundColor3 = Color3.fromRGB(180, 210, 255)
dropdown.Text = "Seleccionar jugador"
dropdown.Font = Enum.Font.GothamBold
dropdown.TextSize = 18
dropdown.TextColor3 = Color3.fromRGB(0, 0, 0)

local selectedPlayer = nil

local menu = Instance.new("ScrollingFrame", tpPlayerFrame)
menu.Size = UDim2.new(1, -20, 0, 90)
menu.Position = UDim2.new(0, 10, 0, 75)
menu.BackgroundColor3 = Color3.fromRGB(210, 230, 255)
menu.BorderSizePixel = 1
menu.ScrollBarThickness = 6
menu.CanvasSize = UDim2.new(0, 0, 0, 0)
menu.Visible = false

local uiListLayout = Instance.new("UIListLayout", menu)
uiListLayout.SortOrder = Enum.SortOrder.LayoutOrder
uiListLayout.Padding = UDim.new(0, 2)

dropdown.MouseButton1Click:Connect(function()
    menu.Visible = not menu.Visible
end)

local function refreshPlayers()
    for _, child in pairs(menu:GetChildren()) do
        if not child:IsA("UIListLayout") then
            child:Destroy()
        end
    end

    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer then
            local btn = Instance.new("TextButton")
            btn.Size = UDim2.new(1, 0, 0, 25)
            btn.BackgroundColor3 = Color3.fromRGB(190, 220, 255)
            btn.Text = plr.Name
            btn.Font = Enum.Font.Gotham
            btn.TextSize = 16
            btn.TextColor3 = Color3.fromRGB(0, 0, 0)
            btn.Parent = menu

            btn.MouseButton1Click:Connect(function()
                selectedPlayer = plr
                dropdown.Text = "ðŸŽ¯ " .. plr.Name
                menu.Visible = false
            end)
        end
    end

    wait()
    menu.CanvasSize = UDim2.new(0, 0, 0, uiListLayout.AbsoluteContentSize.Y)
end

refreshPlayers()
Players.PlayerAdded:Connect(refreshPlayers)
Players.PlayerRemoving:Connect(refreshPlayers)

local tpButton = Instance.new("TextButton", tpPlayerFrame)
tpButton.Size = UDim2.new(1, -20, 0, 40)
tpButton.Position = UDim2.new(0, 10, 1, -50)
tpButton.BackgroundColor3 = Color3.fromRGB(100, 150, 250)
tpButton.Text = "Teleportear"
tpButton.Font = Enum.Font.GothamBold
tpButton.TextSize = 18
tpButton.TextColor3 = Color3.fromRGB(255, 255, 255)

tpButton.MouseButton1Click:Connect(function()
    if selectedPlayer and selectedPlayer.Character then
        local targetHRP = selectedPlayer.Character:FindFirstChild("HumanoidRootPart")
        local myChar = LocalPlayer.Character
        if targetHRP and myChar then
            local myHRP = myChar:FindFirstChild("HumanoidRootPart")
            if myHRP then
                myHRP.CFrame = targetHRP.CFrame + Vector3.new(0, 3, 0)
            end
        end
    end
end)

-- --- Spawn Car Section ---
local spawnCarPosition = Vector3.new(-191.80, 54.77, 1880.36)

local spawnCarFrame = Instance.new("Frame", gui)
spawnCarFrame.Size = UDim2.new(0, 400, 0, 100)
spawnCarFrame.Position = UDim2.new(0, 130, 0, 20)
spawnCarFrame.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
spawnCarFrame.BorderSizePixel = 2
spawnCarFrame.BorderColor3 = Color3.fromRGB(30, 30, 30)
spawnCarFrame.Active = true
spawnCarFrame.Draggable = true
spawnCarFrame.Visible = false
sections["spawnCar"] = spawnCarFrame

local spawnCarTitle = Instance.new("TextLabel", spawnCarFrame)
spawnCarTitle.Size = UDim2.new(1, 0, 0, 30)
spawnCarTitle.BackgroundTransparency = 1
spawnCarTitle.Text = "ðŸš— Spawn Car"
spawnCarTitle.Font = Enum.Font.FredokaOne
spawnCarTitle.TextSize = 20
spawnCarTitle.TextColor3 = Color3.fromRGB(255, 255, 255)

local spawnCarButton = Instance.new("TextButton", spawnCarFrame)
spawnCarButton.Size = UDim2.new(1, -20, 0, 50)
spawnCarButton.Position = UDim2.new(0, 10, 0, 40)
spawnCarButton.BackgroundColor3 = Color3.fromRGB(30, 150, 30)
spawnCarButton.Text = "Spawn Car y Subir"
spawnCarButton.Font = Enum.Font.SourceSansBold
spawnCarButton.TextSize = 18
spawnCarButton.TextColor3 = Color3.fromRGB(255, 255, 255)

local function findButtonUnderCharacter(hrp, maxDistance)
    maxDistance = maxDistance or 6
    local closestButton = nil
    local closestDistance = maxDistance + 1

    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("BasePart") and obj:FindFirstChildOfClass("ClickDetector") then
            local distance = (obj.Position - hrp.Position).Magnitude
            if distance <= maxDistance and distance < closestDistance then
                closestButton = obj
                closestDistance = distance
            end
        end
    end

    return closestButton
end

local function findDriverSeatNear(position, radius)
    radius = radius or 10
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("VehicleSeat") and (obj.Position - position).Magnitude <= radius then
            return obj
        end
    end
    return nil
end

local function teleportAndSpawnCar()
    local character = LocalPlayer.Character
    if not character then return end
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local originalPosition = hrp.Position

    -- Teleportar un poco por encima para evitar colisiones
    hrp.CFrame = CFrame.new(spawnCarPosition + Vector3.new(0, 5, 0))
    print("[SpawnCar] Teleportado al spawn del carro")

    wait(1.5) -- esperar a que todo cargue

    local buttonPart = findButtonUnderCharacter(hrp, 6)
    if buttonPart then
        print("[SpawnCar] BotÃ³n encontrado:", buttonPart:GetFullName())

        local clickDetector = buttonPart:FindFirstChildOfClass("ClickDetector")
        if clickDetector then
            print("[SpawnCar] Disparando ClickDetector...")
            fireclickdetector(clickDetector)
        else
            print("[SpawnCar] No se encontrÃ³ ClickDetector en el botÃ³n.")
            return
        end
    else
        warn("[SpawnCar] No se encontrÃ³ botÃ³n con ClickDetector cerca.")
        return
    end

    wait(2) -- Esperar que el vehÃ­culo aparezca

    local driverSeat = findDriverSeatNear(hrp.Position, 10)
    if driverSeat then
        print("[SpawnCar] Asiento de conductor encontrado:", driverSeat:GetFullName())

        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.Sit = true
            driverSeat:Sit(humanoid)
            wait(0.5)
        else
            warn("[SpawnCar] No se encontrÃ³ Humanoid en el personaje.")
        end

        local vehicleModel = driverSeat:FindFirstAncestorWhichIsA("Model")
        if vehicleModel then
            if vehicleModel.PrimaryPart then
                vehicleModel:SetPrimaryPartCFrame(CFrame.new(originalPosition + Vector3.new(0, 5, 0)))
            else
                driverSeat.CFrame = CFrame.new(originalPosition + Vector3.new(0, 5, 0))
            end
            print("[SpawnCar] VehÃ­culo movido a la posiciÃ³n original")
        else
            print("[SpawnCar] No se encontrÃ³ modelo del vehÃ­culo.")
        end
    else
        warn("[SpawnCar] No se encontrÃ³ asiento de conductor cerca.")
    end
end

spawnCarButton.MouseButton1Click:Connect(teleportAndSpawnCar)

-- --- FunciÃ³n para ocultar/mostrar secciones y botones ---
local function showSection(name)
    for key, frame in pairs(sections) do
        frame.Visible = (key == name)
    end
end

-- Crear botones en sidebar y conectar
local y = 10
local sectionNames = {
    {name = "noclip", text = "Noclip"},
    {name = "speed", text = "Speed"},
    {name = "fly", text = "Fly"},
    {name = "killAura", text = "Kill Aura"},
    {name = "tpJail", text = "TP CÃ¡rcel"},
    {name = "escape", text = "Escapar"},
    {name = "tpPlayer", text = "TP Jugador"},
    {name = "spawnCar", text = "Spawn Car"},
}

for _, data in ipairs(sectionNames) do
    local btn = createSidebarButton(data.name, data.text, y)
    y = y + 50
    btn.MouseButton1Click:Connect(function()
        showSection(data.name)
    end)
end

-- Mostrar noclip por defecto
showSection("noclip")

-- --- BotÃ³n para ocultar menÃº en cada secciÃ³n ---
local function addHideButtonToSection(frame)
    local hideBtn = Instance.new("TextButton", frame)
    hideBtn.Name = "HideMenuButton"
    hideBtn.Size = UDim2.new(0, 100, 0, 30)
    hideBtn.Position = UDim2.new(1, -110, 0, 5)
    hideBtn.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
    hideBtn.Font = Enum.Font.FredokaOne
    hideBtn.TextSize = 18
    hideBtn.TextColor3 = Color3.new(1,1,1)
    hideBtn.Text = "Ocultar menÃº"
    return hideBtn
end

for _, frame in pairs(sections) do
    local hideBtn = addHideButtonToSection(frame)
    hideBtn.MouseButton1Click:Connect(function()
        gui.Enabled = false
    end)
end

-- --- Tecla P para ocultar/mostrar todo ---
UIS.InputBegan:Connect(function(input, processed)
    if not processed and input.KeyCode == Enum.KeyCode.P then
        gui.Enabled = not gui.Enabled
    end
end)
